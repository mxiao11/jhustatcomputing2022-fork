---
title: "Project 1"
author: "Melody"
date: "2022-09-06"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r setup, include=FALSE}
library(pacman)
p_load(ggplot2, tidyverse, here, tidytuesdayR, gapminder)

chocolate <- readRDS(here("data","chocolate.RDS"))
as_tibble(chocolate)
chocolate <- as.data.frame(chocolate)

```

#### Part 1: Exploring Data

1.  Make a histogram of the rating scores to visualize overall distribution of scores, change the bins, pick the one you like best, and explain the difference among the bins and why you chose the one you did.

```{r histograms}
## default (30 bins)
ggplot(data=chocolate, aes(x=rating)) +
  geom_histogram(color="lightblue", fill="lightblue")

## 10 bins
ggplot(data=chocolate, aes(x=rating)) +
  geom_histogram(bins=10, color="salmon", fill="salmon")

## 15 bins
ggplot(data=chocolate, aes(x=rating)) +
  geom_histogram(bins=15, color="red", fill="red")

## 20 bins
ggplot(data=chocolate, aes(x=rating)) +
  geom_histogram(bins=20, color="lightpink", fill="lightpink")

## 25 bins
ggplot(data=chocolate, aes(x=rating)) +
  geom_histogram(bins=25, color="deeppink", fill="deeppink")

```

> I personally like the histogram with 15 bins (colored red) because it doesn't feel as disjointed as the histograms with more bins and so is visually nicer.

2.  How many reviews come from each country of bean origin? (WHAT IS THIS ASKING?)

```{r beans}
table(chocolate$country_of_bean_origin)
# is this asking how many  

```

3.  What is average rating scores from reviews of chocolate bars that have Ecuador as country_of_bean_origin in this dataset? For this same set of reviews, also calculate (1) the total number of reviews and (2) the standard deviation of the rating scores. Your answer should be a new data frame with these three summary statistics in three columns. Label the name of these columns mean, sd, and total.

```{r Ecuador}
ec <- chocolate %>%
  filter(country_of_bean_origin=="Ecuador")
nrow(ec)
mean(ec$rating)
sd(ec$rating, na.rm=TRUE)

## new dataframe with summary statistics
mean_rating <- c(mean(ec$rating))
number_reviews <- c(nrow(ec))
stdev_ratings <- c(sd(ec$rating))

df <- data.frame(mean_rating, number_reviews, stdev_ratings)
df

```

> There are 219 total reviews on chocolate made from beans from Ecuador. The average rating for beans from Ecuador is 3.16. The standard deviation of ratings is 0.512. Please see the new dataframe.

4.  Which country makes the best chocolate (or has the highest ratings on average) with beans from Ecuador?

```{r best beans}
a <- ec %>%
  group_by(company_location) %>%
  mutate(av_rating=mean(rating)) %>%
  distinct(av_rating) 
max(a$av_rating)
a1 <- a %>%
  filter(av_rating==3.8125)
a1

```

> The country that makes the best chocolate with beans from Ecuador with the highest average ratings is Australia.

5.  Calculate the average rating across all country of origins for beans. Which top 3 countries have the highest ratings on average?

```{r top three}
b <- chocolate %>%
  group_by(country_of_bean_origin) %>%
  mutate(av_rating=mean(rating)) %>%
  distinct(av_rating) %>%
  arrange(desc(av_rating))
b

```

> The three countries of origin with the highest average ratings are Tobago, Sao Tome & Principe, and China in that order.

6.  Following up on the previous problem, now remove any countries of bean origins that have less than 10 chocolate bar reviews. Now, which top 3 countries have the highest ratings on average?

```{r best beans part two}
ch <- data.frame(table(chocolate$country_of_bean_origin))
ch <- ch %>%
  rename(country_of_bean_origin = Var1)

c <- left_join(chocolate, ch, by="country_of_bean_origin")  

c <- c %>%
  filter(!(Freq<=10)) %>%
  group_by(country_of_bean_origin) %>%
  mutate(av_rating=mean(rating)) %>%
  distinct(av_rating) %>%
  arrange(desc(av_rating))
c

```

> After removing countries of origin with fewer than 10 chocolate bar reviews, the three countries with the highest ratings on average are Congo, Cuba, and Vietnam, in that order.

7. Relationships between percent chocolate and ratings
```{r percent chocolate and ratings}
## 1. Countries of bean origin with at least 50 reviews
ch <- data.frame(table(chocolate$country_of_bean_origin))
ch <- ch %>%
  rename(country_of_bean_origin = Var1)

d <- left_join(chocolate, ch, by="country_of_bean_origin")
d <- d %>%
  filter(Freq>=50) 

## 2. Chocolate percentage
pc = paste(d$cocoa_percent)
as.numeric(sub("%", "", pc))

## 3. Refactoring
d <- d %>%
  mutate(percent=case_when(
    cocoa_percent<60 ~ "<60%",
    cocoa_percent>=60 & cocoa_percent<70 ~ "60%-70%",
    cocoa_percent>=70 & cocoa_percent<90 ~ "70%-90%",
    cocoa_percent>=90 ~ ">90%"
  ))

d$percent <- factor(x=d$percent, levels=c("<60%","60%-70%","70%-90%",">90%"), 
                    labels=c("<60%","60%-70%","70%-90%",">90%"))

## 4. Boxplots
ggplot(data=d, aes(x=percent, y=rating)) +
  geom_boxplot() +
  facet_wrap(~country_of_bean_origin)

```

> Of the four cocoa percentage categories, the two percentage categories that appear to be the most popular are 60%-70% and 70%-90%. This is not a consistent observation across the included countries, but most countries' most popular chocolate category is one of the two.


#### Part 2: Join two datasets together
```{r joining}
ch <- data.frame(table(chocolate$country_of_bean_origin))
ch <- ch %>%
  rename(country_of_bean_origin = Var1)

e <- left_join(chocolate, ch, by="country_of_bean_origin")
e <- e %>%
  filter(Freq>=10) %>%
  filter(!(country_of_bean_origin=="Blend"))

```



